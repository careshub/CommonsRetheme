/*! CommonsRetheme - v2.0.1 - 2015-07-21 */!function(a,b,c){"use strict";function d(b,c){this.element=b,this.settings=a.extend({},h,c),this._defaults=h,this._name=g,this.mouseTimeoutID=null,this.focusTimeoutID=null,this.mouseFocused=!1,this.justFocused=!1,this.init()}function e(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}function f(b,c){var d,f,g,h=b.nodeName.toLowerCase();return"area"===h?(d=b.parentNode,f=d.name,b.href&&f&&"map"===d.nodeName.toLowerCase()?(g=a("img[usemap=#"+f+"]")[0],!!g&&e(g)):!1):(/input|select|textarea|button|object/.test(h)?!b.disabled:"a"===h?b.href||c:c)&&e(b)}var g="accessibleMegaMenu",h={uuidPrefix:"accessible-megamenu",menuClass:"accessible-megamenu",topNavItemClass:"accessible-megamenu-top-nav-item",panelClass:"accessible-megamenu-panel",panelGroupClass:"accessible-megamenu-panel-group",hoverClass:"hover",focusClass:"focus",openClass:"open"},i={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38,keyMap:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",190:"."}};d.prototype=function(){var e,f,h,j,k,l,m,n,o,p,q,r,s,t=0,u=1e3,v="",w=1==("ontouchstart"in b||b.DocumentTouch&&c instanceof DocumentTouch);return e=function(b){return a(b).closest(":data(plugin_"+g+")").data("plugin_"+g)},f=function(b){b=a(b);var c=this.settings;b.attr("id")||b.attr("id",c.uuidPrefix+"-"+(new Date).getTime()+"-"+ ++t)},h=function(b,d){var e,f=a(b.target),g=this,h=this.settings,j=this.menu,k=f.closest("."+h.topNavItemClass),l=f.hasClass(h.panelClass)?f:f.closest("."+h.panelClass);if(s.call(this,!0),d)if(k=j.find("."+h.topNavItemClass+" ."+h.openClass+":first").closest("."+h.topNavItemClass),k.is(b.relatedTarget)||k.has(b.relatedTarget).length>0)0===k.length&&j.find("[aria-expanded=true]").attr("aria-expanded","false").removeClass(h.openClass).filter("."+h.panelClass).attr("aria-hidden","true");else{if(("mouseout"===b.type||"focusout"===b.type)&&k.has(c.activeElement).length>0)return;k.find("[aria-expanded]").attr("aria-expanded","false").removeClass(h.openClass).filter("."+h.panelClass).attr("aria-hidden","true"),("keydown"===b.type&&b.keyCode===i.ESCAPE||"DOMAttrModified"===b.type)&&(e=k.find(":tabbable:first"),setTimeout(function(){j.find("[aria-expanded]."+g.settings.panelClass).off("DOMAttrModified.accessible-megamenu"),e.focus(),g.justFocused=!1},99))}else clearTimeout(g.focusTimeoutID),k.siblings().find("[aria-expanded]").attr("aria-expanded","false").removeClass(h.openClass).filter("."+h.panelClass).attr("aria-hidden","true"),k.find("[aria-expanded]").attr("aria-expanded","true").addClass(h.openClass).filter("."+h.panelClass).attr("aria-hidden","false"),"mouseover"===b.type&&f.is(":tabbable")&&1===k.length&&0===l.length&&j.has(c.activeElement).length>0&&(f.focus(),g.justFocused=!1),s.call(g)},j=function(b){var c=a(b.target),d=c.closest("."+this.settings.topNavItemClass),e=c.closest("."+this.settings.panelClass);1===d.length&&0===e.length&&1===d.find("."+this.settings.panelClass).length&&(c.hasClass(this.settings.openClass)?this.justFocused?(b.preventDefault(),b.stopPropagation(),this.justFocused=!1):w&&(b.preventDefault(),b.stopPropagation(),h.call(this,b,c.hasClass(this.settings.openClass))):(b.preventDefault(),b.stopPropagation(),h.call(this,b),this.justFocused=!1))},k=function(b){0===a(b.target).closest(this.menu).length&&(b.preventDefault(),b.stopPropagation(),h.call(this,b,!0))},l=function(b){"aria-expanded"===b.originalEvent.attrName&&"false"===b.originalEvent.newValue&&a(b.target).hasClass(this.settings.openClass)&&(b.preventDefault(),b.stopPropagation(),h.call(this,b,!0))},m=function(b){clearTimeout(this.focusTimeoutID);var c=a(b.target),d=c.closest("."+this.settings.panelClass);c.addClass(this.settings.focusClass).on("click.accessible-megamenu",a.proxy(j,this)),this.justFocused=!this.mouseFocused,this.mouseFocused=!1,this.panels.not(d).filter("."+this.settings.openClass).length&&h.call(this,b)},n=function(c){this.justFocused=!1;var d=this,e=a(c.target),f=e.closest("."+this.settings.topNavItemClass);e.removeClass(this.settings.focusClass).off("click.accessible-megamenu"),d.focusTimeoutID=b.cvox?setTimeout(function(){b.cvox.Api.getCurrentNode(function(a){f.has(a).length?clearTimeout(d.focusTimeoutID):d.focusTimeoutID=setTimeout(function(a,b,c){h.call(a,b,c)},275,d,c,!0)})},25):setTimeout(function(){h.call(d,c,!0)},300)},o=function(c){var f,g,k,l,m,n,o=this.constructor===d?this:e(this),p=o.settings,q=a(a(this).is("."+p.hoverClass+":tabbable")?this:c.target),r=o.menu,s=o.topnavitems,t=q.closest("."+p.topNavItemClass),w=r.find(":tabbable"),x=q.hasClass(p.panelClass)?q:q.closest("."+p.panelClass),y=x.find("."+p.panelGroupClass),z=q.closest("."+p.panelGroupClass),A=c.keyCode||c.which,B=!1,C=i.keyMap[c.keyCode]||"",D=1===t.length&&0===x.length;if(!q.is("input:focus, select:focus, textarea:focus, button:focus")){switch(q.is("."+p.hoverClass+":tabbable")&&a("html").off("keydown.accessible-megamenu"),A){case i.ESCAPE:h.call(o,c,!0);break;case i.DOWN:c.preventDefault(),D?(h.call(o,c),B=1===t.find("."+p.panelClass+" :tabbable:first").focus().length):B=1===w.filter(":gt("+w.index(q)+"):first").focus().length,!B&&b.opera&&"[object Opera]"===opera.toString()&&(c.ctrlKey||c.metaKey)&&(w=a(":tabbable"),k=w.index(q),B=1===a(":tabbable:gt("+a(":tabbable").index(q)+"):first").focus().length);break;case i.UP:c.preventDefault(),D&&q.hasClass(p.openClass)?(h.call(o,c,!0),f=s.filter(":lt("+s.index(t)+"):last"),f.children("."+p.panelClass).length&&(B=1===f.children().attr("aria-expanded","true").addClass(p.openClass).filter("."+p.panelClass).attr("aria-hidden","false").find(":tabbable:last").focus())):D||(B=1===w.filter(":lt("+w.index(q)+"):last").focus().length),!B&&b.opera&&"[object Opera]"===opera.toString()&&(c.ctrlKey||c.metaKey)&&(w=a(":tabbable"),k=w.index(q),B=1===a(":tabbable:lt("+a(":tabbable").index(q)+"):first").focus().length);break;case i.RIGHT:c.preventDefault(),D?B=1===s.filter(":gt("+s.index(t)+"):first").find(":tabbable:first").focus().length:(y.length&&z.length&&(B=1===y.filter(":gt("+y.index(z)+"):first").find(":tabbable:first").focus().length),B||(B=1===t.find(":tabbable:first").focus().length));break;case i.LEFT:c.preventDefault(),D?B=1===s.filter(":lt("+s.index(t)+"):last").find(":tabbable:first").focus().length:(y.length&&z.length&&(B=1===y.filter(":lt("+y.index(z)+"):last").find(":tabbable:first").focus().length),B||(B=1===t.find(":tabbable:first").focus().length));break;case i.TAB:k=w.index(q),c.shiftKey&&D&&q.hasClass(p.openClass)?(h.call(o,c,!0),f=s.filter(":lt("+s.index(t)+"):last"),f.children("."+p.panelClass).length&&(B=f.children().attr("aria-expanded","true").addClass(p.openClass).filter("."+p.panelClass).attr("aria-hidden","false").find(":tabbable:last").focus())):c.shiftKey&&k>0?B=1===w.filter(":lt("+k+"):last").focus().length:!c.shiftKey&&k<w.length-1?B=1===w.filter(":gt("+k+"):first").focus().length:b.opera&&"[object Opera]"===opera.toString()&&(w=a(":tabbable"),k=w.index(q),B=c.shiftKey?1===a(":tabbable:lt("+a(":tabbable").index(q)+"):last").focus().length:1===a(":tabbable:gt("+a(":tabbable").index(q)+"):first").focus().length),B&&c.preventDefault();break;case i.SPACE:if(!D)return!0;c.preventDefault(),j.call(o,c);break;case i.ENTER:return!0;default:if(clearTimeout(this.keydownTimeoutID),v+=C!==v?C:"",0===v.length)return;for(this.keydownTimeoutID=setTimeout(function(){v=""},u),w=D&&!q.hasClass(p.openClass)?w.filter(":not(."+p.panelClass+" :tabbable)"):t.find(":tabbable"),c.shiftKey&&(w=a(w.get().reverse())),k=0;k<w.length;k++)if(l=w.eq(k),l.is(q)){g=1===v.length?k+1:k;break}for(n=new RegExp("^"+v.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),"i"),k=g;k<w.length;k++)if(l=w.eq(k),m=a.trim(l.text()),n.test(m)){B=!0,l.focus();break}if(!B)for(k=0;g>k;k++)if(l=w.eq(k),m=a.trim(l.text()),n.test(m)){l.focus();break}}o.justFocused=!1}},p=function(b){a(b.target).is(":focusable, ."+this.settings.panelClass)&&(this.mouseFocused=!0),this.mouseTimeoutID=setTimeout(function(){clearTimeout(this.focusTimeoutID)},1)},q=function(b){clearTimeout(this.mouseTimeoutID),a(b.target).addClass(this.settings.hoverClass),h.call(this,b),a(b.target).is(":tabbable")&&a("html").on("keydown.accessible-megamenu",a.proxy(o,b.target))},r=function(b){var c=this;a(b.target).removeClass(c.settings.hoverClass),c.mouseTimeoutID=setTimeout(function(){h.call(c,b,!0)},250),a(b.target).is(":tabbable")&&a("html").off("keydown.accessible-megamenu")},s=function(b){var c=this.menu;b?(a("html").off("mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu"),c.find("[aria-expanded]."+this.settings.panelClass).off("DOMAttrModified.accessible-megamenu")):(a("html").on("mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu",a.proxy(k,this)),c.find("[aria-expanded=true]."+this.settings.panelClass).on("DOMAttrModified.accessible-megamenu",a.proxy(l,this)))},{constructor:d,init:function(){var b=this,d=this.settings,e=this.nav=a(this.element),g=this.menu=e.children().first(),h=this.topnavitems=g.children();e.attr("role","navigation"),g.addClass(d.menuClass),h.each(function(c,e){var g,h;e=a(e),e.addClass(d.topNavItemClass),g=e.find(":tabbable:first"),h=e.children(":not(:tabbable):last"),f.call(b,g),h.length&&(f.call(b,h),g.attr({"aria-haspopup":!0,"aria-controls":h.attr("id"),"aria-expanded":!1}),h.attr({role:"group","aria-expanded":!1,"aria-hidden":!0}).addClass(d.panelClass).not("[aria-labelledby]").attr("aria-labelledby",g.attr("id")))}),this.panels=g.find("."+d.panelClass),g.on("focusin.accessible-megamenu",":focusable, ."+d.panelClass,a.proxy(m,this)).on("focusout.accessible-megamenu",":focusable, ."+d.panelClass,a.proxy(n,this)).on("keydown.accessible-megamenu",a.proxy(o,this)).on("mouseover.accessible-megamenu",a.proxy(q,this)).on("mouseout.accessible-megamenu",a.proxy(r,this)).on("mousedown.accessible-megamenu",a.proxy(p,this)),w&&g.on("touchstart.accessible-megamenu",a.proxy(j,this)),g.find("hr").attr("role","separator"),a(c.activeElement).closest(g).length&&a(c.activeElement).trigger("focusin.accessible-megamenu")},getDefaults:function(){return this._defaults},getOption:function(a){return this.settings[a]},getAllOptions:function(){return this.settings},setOption:function(a,b,c){this.settings[a]=b,c&&this.init()}}}(),a.fn[g]=function(b){return this.each(function(){a.data(this,"plugin_"+g)||a.data(this,"plugin_"+g,new d(this,b))})},a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return f(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var c=a.attr(b,"tabindex"),d=isNaN(c);return(d||c>=0)&&f(b,!d)}})}(jQuery,window,document),jQuery&&!function(a){"use strict";a(document).ready(function(){a("#menu-toggler").click(function(){return a(".nav-container").toggleClass("open"),!1}),a(".primary-navigation nav").accessibleMegaMenu(),setTimeout(function(){a("body").removeClass("init")},500)})}(jQuery);